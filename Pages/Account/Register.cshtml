@page
@model Geography4Geek_1.Pages.Account.RegisterModel
@using Geography4Geek_1.Models
@{
    ViewData["Title"] = "Registrazione";
}

<h2>Registrazione</h2>

<div class="row">
    <div class="col-md-6">
        <form id="registerForm" method="post" onsubmit="document.getElementById('registerButton').disabled = true;">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group mb-3">
                <label asp-for="Input.Email" class="form-label">Email</label>
                <input asp-for="Input.Email" class="form-control" autocomplete="username" aria-required="true" />
                <span asp-validation-for="Input.Email" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Input.FirstName" class="form-label">Nome</label>
                <input asp-for="Input.FirstName" class="form-control" aria-required="true" />
                <span asp-validation-for="Input.FirstName" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Input.LastName" class="form-label">Cognome</label>
                <input asp-for="Input.LastName" class="form-control" aria-required="true" />
                <span asp-validation-for="Input.LastName" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Input.Role" class="form-label">Ruolo</label>
                <select asp-for="Input.Role" class="form-control" asp-items="Html.GetEnumSelectList<UserRole>()">
                    <option value="">Seleziona un ruolo</option>
                </select>
                <span asp-validation-for="Input.Role" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Input.Password" class="form-label">Password</label>
                <input asp-for="Input.Password" class="form-control" type="password" autocomplete="new-password" aria-required="true" />
                <span asp-validation-for="Input.Password" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Input.ConfirmPassword" class="form-label">Conferma Password</label>
                <input asp-for="Input.ConfirmPassword" class="form-control" type="password" autocomplete="new-password" aria-required="true" />
                <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
            </div>

            <div id="registerError" class="text-danger mb-3" style="display:none">
                Si è verificato un errore durante la registrazione. Riprova.
            </div>

            <button id="registerButton" type="submit" class="btn btn-primary btn-lg">
                Registrati
            </button>
        </form>
    </div>
</div>

<div class="mt-3">
    <p>Hai già un account? <a asp-page="./Login">Accedi</a></p>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Verifica che il form di registrazione funzioni correttamente
            document.addEventListener('DOMContentLoaded', function() {
                    const form = document.getElementById('registerForm');

                    if (form) {
                        form.addEventListener('submit', function(e) {
                            const button = document.getElementById('registerButton');
                            if (button) {
                                // Cambia il testo del pulsante per dare feedback
                                button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Registrazione in corso...';
                            }

                            // Il form continuerà a inviarsi normalmente
                        });
                    }
                });
    </script>
}